       {% extends "base.html" %}  
       {% block content %}           
                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">PREPARE Haiti</a></li>
                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Pages</a></li>
                                            <li class="breadcrumb-item active">Dashboard</li>
                                        </ol>
                                    </div>
                                    <h4 class="page-title">PREPARE Haiti</h4>
                                </div>
                            </div>
                        </div>     
                        <!-- end page title --> 
                        
                        <div class="row">
                            
                            <div class="col-xl-3 col-lg-4">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi bg-success text-white widget-icon"  style="height:50px;width:50px"><img style="width: 30px; height: 50px;" src="/static/images/house_original.svg"></i>
                                        </div>
                                        <h4 class="text-muted fw-normal mt-0" title="Tag">No Restricted Hazards</h4>
                                        <div id="green-spinner" class="spinner-border spinner-border-sm" role="status"></div>
                                        <h1 class="mt-3 mb-3" id="greencount"></h1>
                                        
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-3 col-lg-4">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi  text-white widget-icon" style="background-color: #fad172;height:50px;width:50px" ><img style="width: 30px; height: 50px;" src="/static/images/house_restricted.svg"></i>
                                          
                                        </div>
                                        <h4 class="text-muted fw-normal mt-0" title="Tag">Restricted Use</h4>
                                        <h1 class="mt-3 mb-3" id="yellowcount">0</h1>
                                       
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-3 col-lg-4">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi  text-white widget-icon" style="background-color:  #d75146;height:50px;width:50px" ><img style="width: 30px; height: 50px;" src="/static/images/house_unsafe.svg"></i>
                                        </div>
                                        <h4 class="text-muted fw-normal mt-0" title="Tag">Unsafe</h4>
                                        <h1 class="mt-3 mb-3" id="redcount">0</h1>
                                       
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-3 col-lg-4">
                              <div class="card widget-flat">
                                  <div class="card-body">
                                      <div class="float-end">
                                          <!-- <i class="mdi  text-white widget-icon" style="background-color:  #d75146;height:50px;width:50px" ><img style="width: 30px; height: 50px;" src="/static/images/house_unsafe.svg"></i> -->
                                      </div>
                                      <h4 class="text-muted fw-normal mt-0" title="Tag">Total Assessments</h4>
                              
                                        
                                      <div id="total-spinner" class="spinner-border spinner-border-sm" role="status"></div>
                                      <h1 class="mt-3 mb-3" id ="total-assessments"></h1>
                                  </div>
                              </div>
                          </div>
                      </div>
    


                        </div>

                        
                        
                        
                        <div class="row">
                            <div class="col-xl-4 col-lg-6">
                               
                                <!-- Messages-->
                                <div class="card">
                                    <div class="card-body">
                                        <div class="dropdown float-end">
                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="mdi mdi-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <!-- item-->
                                                <a href="javascript:void(0);" class="dropdown-item">Settings</a>
                                                <!-- item-->
                                                <a href="javascript:void(0);" class="dropdown-item">Action</a>
                                            </div>
                                        </div>
                                        <h4 class="header-title mb-3">Data Visualization</h4>

                                        <ul class="nav nav-tabs nav-bordered mb-3">
                                            <li class="nav-item">
                                                <a href="#home-b1" data-bs-toggle="tab" aria-expanded="true" class="nav-link active">
                                                    <i class="mdi mdi-home-variant d-md-none d-block"></i>
                                                    <span class="d-none d-md-block">Commune</span>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="#profile-b1" data-bs-toggle="tab" aria-expanded="false" class="nav-link ">
                                                    <i class="mdi mdi-account-circle d-md-none d-block"></i>
                                                    <span class="d-none d-md-block">Structural Hazards</span>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="#settings-b1" data-bs-toggle="tab" aria-expanded="false" class="nav-link">
                                                    <i class="mdi mdi-settings-outline d-md-none d-block"></i>
                                                    <span class="d-none d-md-block">Non-Structural Hazards</span>
                                                </a>
                                            </li>
                                        </ul>
                                        
                                        <div class="tab-content">
                                            <div class="tab-pane  show active" id="home-b1">
                                                

                                        
                                            </div>
                                            <div class="tab-pane" id="profile-b1">
                                                <div id="overall" class="apex-charts"
                                                data-colors="#48bf76, #fa5c7c, #d75146"></div>
                                            </div>
                                            <div class="tab-pane" id="settings-b1">
                                                <div id="overall" class="apex-charts"
                                                data-colors="#48bf76, #fa5c7c, #d75146"></div>
                                            </div>
                                        </div>   





                                    </div> <!-- end card-body-->
                                </div> <!-- end card-->

                            </div> <!-- end col-->

                            <div class="col-xl-8 col-lg-7">
                                <div class="card">
                                    <div class="card-body">
                                      <div class="button-list">
                                        <button type="button" onclick="download()" id="download" class="btn btn-info"><i class="mdi mdi-download me-1"></i> <span>Download CSV</span> </button>
                                        <button type="button" onclick="downloadgeojson()" id="downloadgeojson" class="btn btn-info"><i class="mdi mdi-download me-1"></i> <span>Download GeoJSON</span> </button>
                                    
                                    </div>
                                           
                                  
                                        </div>
                                                <!-- Start Map -->
                            <div dir="ltr">
                                <div class="mt-3 chartjs-chart" style="height: 800px">
                                  
                                  <div id="mapid" style="height: 800px"><div class="d-flex justify-content-center"><div class="spinner-border avatar-lg text-primary" role="status"></div></div></div>
                                </div>
                                
                                
                              </div>     
                                            <!-- end about me section content -->
    
                                            <div class="tab-pane show active" id="timeline">
                                              
                                              <div id="chart" class="apex-charts" data-colors="#48bf76, #fa5c7c, #d75146"></div>
                                            <!-- end timeline content-->
    
                                        </div> <!-- end tab-content -->
                                    </div> <!-- end card body -->
                                </div> <!-- end card -->
                            </div> <!-- end col -->
                        </div>

                        




                        <!-- end row-->

                    </div>
                    <!-- container -->

                </div>
                <!-- content -->

                

                <script src="/static//js/vendor.min.js"></script>
                <script src="/static//js/app.min.js"></script>
                <script src="/static//js/vendor/apexcharts.min.js"></script>
                <script src="/static//js/vendor.min.js"></script>
                <script src="/static//js/app.min.js"></script>
    
    
      <script type="text/javascript">
        $(document).ready(function(){
        
          jQuery.ajax({
                    type: "GET",
                    url: "/assessment-data/stats?dashboard=True",
                    data: "data",
                    dataType: "json",
                    success: function (response) {
                      populateDom(response)
                    },
                  });

        
        });



        var options = {
          chart: {
              height: 650,
              type: 'bar',
          },
          dataLabels: {
              enabled: true,
              
          },
          series: [],
          title: {
              text: 'Assessments by Commune',
          },
          noData: {
            text: 'Loading...'
          },
          plotOptions: {
            bar: {
              barHeight: '70%',
              columnWidth: '70%',
              borderRadius: 4,
              
            }
          },
  
        }
        
        var chart = new ApexCharts(
          document.querySelector("#chart"),
          options
        );
        
        chart.render();

 
        
        function populateDom(data) {


          chart.updateSeries([{
            name: 'Assessments',
            data: data.commune
          }])


          document.getElementById("total-assessments").innerText = data.total_assessments
          document.getElementById("total-spinner").remove()

          document.getElementById("greencount").innerText = data.tags[2].count
          document.getElementById("green-spinner").remove()
          document.getElementById("yellowcount").innerText = data.tags[1].count
          document.getElementById("redcount").innerText = data.tags[3].count

         
          

        }

      



        var mymap = L.map("mapid").setView(["18.1959839", "-73.7531521"], 17);
        L.tileLayer(
          "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWl5YW1vdG9pbnRlcm5hdGlvbmFsIiwiYSI6ImNrc2phYW0xcTI4d3Iyem5xMmh1ZjRsZ2EifQ.Yh7n3cI78Rc7QBnQcQTSmw",
          {
            attribution:
              'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            backgroundcolor: "red",
            id: "mapbox/streets-v11",
            tileSize: 512,
            zoomOffset: -1,
            accessToken:
              "pk.eyJ1IjoibWl5YW1vdG9pbnRlcm5hdGlvbmFsIiwiYSI6ImNrc2phYW0xcTI4d3Iyem5xMmh1ZjRsZ2EifQ.Yh7n3cI78Rc7QBnQcQTSmw",
          }
        ).addTo(mymap);
    
        // var marker = L.marker([jQuery('#my-data').data('latitude'), jQuery('#my-data').data('longitude')]).addTo(mymap);
    
        var greenIcon = new L.Icon({
            iconUrl: "/static//images/marker-green.png",
            iconSize: [41, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
    });
    
    var yellowIcon = new L.Icon({
        iconUrl: "/static//images/marker-yellow.png",
            iconSize: [41, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
    });
    
    
    var redIcon = new L.Icon({
        iconUrl: "/static//images/marker-red.png",
            iconSize: [41, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
    });
           
            var redtag = L.layerGroup()
            var yellowtag = L.layerGroup()
            var greentag = L.layerGroup()

      </script>





    </body>
</html>

{% endblock %}