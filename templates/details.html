{% extends "base.html" %}  
{% block content %} 

                    <!-- Start Content-->
                    <div class="container-fluid">
                        
                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right">
                                       
                                       <button type="button" class="btn btn-secondary"><i class="mdi mdi-download"></i> Télécharger le rapport complet</button>
                                          
                                       
                                    </div>
                                    <h1 class="page-title" style ="margin-bottom: 5px!important;line-height: 28px!important; font-size:28px!important;margin-top:30px!important">{{data.D_group_idencontact_NIB}} </h1>
                                    <h2><span id = "tag" class="badge bg-danger" >Red Tagged</span></h2>
                                    
                                </div>
                            </div>
                        </div>     
                        <!-- end page title --> 

                        <div class="row">
                            <div dir="ltr">
                                <div class="mt-3 chartjs-chart" style="height: 520px;">
                                    <div id="mapid" style="height: 500px;"></div><br>

                                </div>
                            </div>
                            <div class="col-lg-6 col-xxl-4">
                                
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Contact Information</h5>
                                            
                                        
                                        
                                        <ul class="list-group">
                                            <li class="list-group-item"><i class="uil-user-square me-1"></i> <b> Name: </b>{{data.D_group_idencontact_Nom_de_la_personne_contact_facultatif}}</li>
                                            <li class="list-group-item"><i class=" uil-phone me-1"></i><b> Numéro de téléphone: </b> {{data.D_group_idencontact_Num_ro_de_t_l_phone_facultatif}}</li>
                                            <li class="list-group-item"><i class=" uil-map-marker me-1"></i><b>Adresse: </b>{{data.D_group_loca_adresse_D_0003}}</li>
                                            <li class="list-group-item"><i class=" uil-map-pin-alt me-1"></i><b> Coordonnées: </b>{{data._geolocation[0]}}, {{data._geolocation[1]}}</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- end card-->

                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Informations sur l'évaluation</h5>
                                        
                                  
                                
                                        <ul class="list-group">
                                            <li class="list-group-item"><i class="uil-user-hard-hat me-1"></i> <b>Nom des ingénieur:</b> {{data.group_td8pi04_B_0001}}</li>
                                            <li class="list-group-item"><i class="uil-info-circle me-1"></i> <b> Kobo ID:</b> {{data._id}}</li>
                                            <li class="list-group-item"><i class="uil-heart-rate me-1"></i><b>Type d'inspection:</b> {{data.E_group_da1jv19_E_0001 | replace("_", "/")}}</li>
                                            <li class="list-group-item"><i class="uil-calendar-alt me-1"></i><b>Date de l'enquete:</b> {{data.A_date_enquete }}</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- end card-->
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Images</h5>
                                        {% for item in data._attachments %}
                                        <a href="{{item.download_url}}" target="_blank" ><img src="{{item.download_medium_url}}" alt="image" class="img-fluid img-thumbnail" width="200"/></a>
                                        {% endfor %}
                                       
                                    </div>
                                </div>
                                <!-- end card-->


                                    
                            </div>
                            <div class="col-xxl-8 col-lg-6">
                                
                                <!-- project card -->
                           

                               
                                <div class="row">
                                    <div class="col-xl-4 col-lg-12">
                                     
                                        <div class="card widget-flat">
                                            <div class="card-body">
                                                <div class="float-end">
                                                    <i class="mdi mdi-calendar-month-outline widget-icon bg-light rounded-circle text-primary"></i>
                                                </div>
                                                <h5 class="text-muted fw-normal mt-0" title="Revenue">Date de début de construction</h5>
                                                <h3 class="mt-3 mb-3">{{data.J_I_0002 | replace("_", " ")}}</h3>
                                             
                                            </div>
                                        </div>
                                    </div> <!-- end col -->
        
                                    
                                        <div class="col-xl-4 col-lg-12">
                                            <div class="card widget-flat">
                                                <div class="card-body">
                                                    <div class="float-end">
                                                        <i class="mdi mdi-sign-caution widget-icon bg-light rounded-circle text-primary"></i>
                                                    </div>
                                                    <h5 class="text-muted fw-normal mt-0" title="Growth">Dommage estimé</h5>
                                                    <h3 class="mt-3 mb-3">{{data.H_H_0002 | replace("_", "-")}}</h3>
                                                   
                                                </div>
                                            </div>
                                    </div> <!-- end col -->
                                    <div class="col-xl-4 col-lg-12">
                                        <div class="card widget-flat">
                                            <div class="card-body">
                                                <div class="float-end">
                                                    <i class="mdi mdi-calendar widget-icon bg-light rounded-circle text-primary"></i>
                                                </div>
                                                <h5 class="text-muted fw-normal mt-0" title="Growth">Expertise détaillée recommandée</h5>
                                                <h3 class="mt-3 mb-3">{{data.H_H_0005 | replace("_", " ") | capitalize}}</h3>
                                               
                                            </div>
                                        </div>


                                        

                                </div> <!-- end col -->

                                
                                <div class="col-xl-12 col-lg-12">
                                    
                                    <div class="card widget-flat">
                                        <div class="card-body">

                                            
                                    <div class="row mx-n1 g-0">
                                        
                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-eye font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Type d'inspection</a>
                                                            <p class="mb-0 font-13">{{data.E_group_da1jv19_E_0001 | replace("_", " ") |capitalize}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->

                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-arrow-up-thick font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Nombre d'etages</a>
                                                            <p class="mb-0 font-13">{{data.E_group_sp4ka97_E_0002}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->

                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-home-city font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Type de structure</a>
                                                            <p class="mb-0 font-13">{{data.E_group_xu4pt81_E_0004 | replace("_", " ")}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->

                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-tape-measure font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold"> Surperficie approximative</a>
                                                            <p class="mb-0 font-13">{{data.F_F_0001}} m²</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->
                                        
                                    </div> <!-- end row-->
                                    <div class="row mx-n1 g-0">
                                        
                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-home-roof font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Type de toiture</a>
                                                            <p class="mb-0 font-13">{{data.E_group_xu4pt81_type_toiture | replace("_", " ")}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->

                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-home-city font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Type de plancher</a>
                                                            <p class="mb-0 font-13">{{data.E_group_xu4pt81_E_0005 | replace("_", " ")}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->

                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-home-alert font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Nombre de résidence</a>
                                                            <p class="mb-0 font-13">{{data.F_F_0002}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->

                                        <div class="col-xxl-3 col-lg-6">
                                            <div class="card m-1 shadow-none border">
                                                <div class="p-2">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <div class="avatar-sm">
                                                                <span class="avatar-title bg-light text-secondary rounded">
                                                                    <i class="mdi mdi-terrain font-16"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="col ps-0">
                                                            <a href="javascript:void(0);" class="text-muted fw-bold">Type de mur</a>
                                                            <p class="mb-0 font-13">{{data.E_group_xu4pt81_type_mur | replace("_", " ")}}</p>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div> <!-- end .p-2-->
                                            </div> <!-- end col -->
                                        </div> <!-- end col-->
                                        
                                    </div> <!-- end row-->
                                </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="header-title mb-4">Structural Damage</h4>
                                    <div dir="ltr">
    
                                        <div id = "chart"></div>
                                    </div>
                                </div>
                                <!-- end card body-->
                            </div>
                            <!-- end card -->
                            

                            </div> <!-- end col -->

                       
                        </div>
                        <!-- end row -->
                        
                    </div> <!-- container -->

                </div> <!-- content -->

            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->


        </div>
        <!-- END wrapper -->


        <!-- Right Sidebar -->
        <div class="end-bar">

            <div class="rightbar-title">
                <a href="javascript:void(0);" class="end-bar-toggle float-end">
                    <i class="dripicons-cross noti-icon"></i>
                </a>
                <h5 class="m-0">Settings</h5>
            </div>

            <div class="rightbar-content h-100" data-simplebar>

                <div class="p-3">
                    <div class="alert alert-warning" role="alert">
                        <strong>Customize </strong> the overall color scheme, sidebar menu, etc.
                    </div>

                    <!-- Settings -->
                    <h5 class="mt-3">Color Scheme</h5>
                    <hr class="mt-1" />

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="color-scheme-mode" value="light" id="light-mode-check" checked>
                        <label class="form-check-label" for="light-mode-check">Light Mode</label>
                    </div>

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="color-scheme-mode" value="dark" id="dark-mode-check">
                        <label class="form-check-label" for="dark-mode-check">Dark Mode</label>
                    </div>
       

                    <!-- Width -->
                    <h5 class="mt-4">Width</h5>
                    <hr class="mt-1" />
                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="width" value="fluid" id="fluid-check" checked>
                        <label class="form-check-label" for="fluid-check">Fluid</label>
                    </div>

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="width" value="boxed" id="boxed-check">
                        <label class="form-check-label" for="boxed-check">Boxed</label>
                    </div>
        

                    <!-- Left Sidebar-->
                    <h5 class="mt-4">Left Sidebar</h5>
                    <hr class="mt-1" />
                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="theme" value="default" id="default-check">
                        <label class="form-check-label" for="default-check">Default</label>
                    </div>

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="theme" value="light" id="light-check" checked>
                        <label class="form-check-label" for="light-check">Light</label>
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" name="theme" value="dark" id="dark-check">
                        <label class="form-check-label" for="dark-check">Dark</label>
                    </div>

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="compact" value="fixed" id="fixed-check" checked>
                        <label class="form-check-label" for="fixed-check">Fixed</label>
                    </div>

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="compact" value="condensed" id="condensed-check">
                        <label class="form-check-label" for="condensed-check">Condensed</label>
                    </div>

                    <div class="form-check form-switch mb-1">
                        <input class="form-check-input" type="checkbox" name="compact" value="scrollable" id="scrollable-check">
                        <label class="form-check-label" for="scrollable-check">Scrollable</label>
                    </div>

                    <div class="d-grid mt-4">
                        <button class="btn btn-primary" id="resetBtn">Reset to Default</button>
            
                      
                    </div>
                </div> <!-- end padding-->

            </div>
            <meta id="my-data" data-latitude="{{data._geolocation[0]}}" data-longitude="{{data._geolocation[1]}}">

        </div>

        <div class="rightbar-overlay"></div>
        <!-- /End-bar -->
        <script type="text/javascript">
        

$( document ).ready(function() {
    document.getElementById ("searchbutton").addEventListener ("click", search, false);
    
    function search(){
        console.log(document.getElementById('searchtext').value)
        window.location.href = "/report/" + document.getElementById('searchtext').value;
    }

    tagged ="{{data.L_K_0014}}"

var greenIcon = new L.Icon({
            iconUrl: "{{ url_for('static', filename='/images/marker-green.png') }}",
            iconSize: [41, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
    });
    
    var yellowIcon = new L.Icon({
        iconUrl: "{{ url_for('static', filename='/images/marker-yellow.png') }}",
            iconSize: [41, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
    });
    

    
    var redIcon = new L.Icon({
        iconUrl: "{{ url_for('static', filename='/images/marker-red.png') }}",
            iconSize: [41, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
    });


        var mymap = L.map('mapid').setView([jQuery('#my-data').data('latitude'), jQuery('#my-data').data('longitude')], 18);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWl5YW1vdG9pbnRlcm5hdGlvbmFsIiwiYSI6ImNrc2phYW0xcTI4d3Iyem5xMmh1ZjRsZ2EifQ.Yh7n3cI78Rc7QBnQcQTSmw', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            backgroundcolor: "red",
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoibWl5YW1vdG9pbnRlcm5hdGlvbmFsIiwiYSI6ImNrc2phYW0xcTI4d3Iyem5xMmh1ZjRsZ2EifQ.Yh7n3cI78Rc7QBnQcQTSmw'
            }).addTo(mymap);   


            
            if (tagged == "rouge") {
            var newMarker = L.marker([jQuery('#my-data').data('latitude'), jQuery('#my-data').data('longitude')], {icon: redIcon}).addTo(mymap);
        
          
            newMarker.image = redIcon
          
            }
    
            if (tagged == "jaune") {
                var newMarker = L.marker([jQuery('#my-data').data('latitude'), jQuery('#my-data').data('longitude')], {icon: yellowIcon}).addTo(mymap);
      
            newMarker.image = yellowIcon
         
            }
    
            if (tagged == "verte") {
            var newMarker = L.marker([jQuery('#my-data').data('latitude'), jQuery('#my-data').data('longitude')], {icon: greenIcon}).addTo(mymap);
            newMarker.image = greenIcon
       
            }


    var tagged = "{{data.L_K_0014}}"


    if (tagged =="rouge") {
    $("#tag").text("Rouge | Unsafe");
    
}
    if (tagged =="jaune") {
    $("#tag").text("Jaune | Restricted");
    
    $('#tag').removeClass('bg-danger').addClass('bg-warning');
}


    if (tagged =="verte") {

        $("#tag").text("Verte | Safe");
        $('#tag').removeClass('bg-danger').addClass('bg-success');
    }

   
  var bat = "{{data.offoundation}}"


  function damagelevel(text) {
    if (text =="aucun" || text =="Aucune" || text =="aucune" ) {
        return 0; 
    }
      
    
    if (text =="mineur") {
        return 1; 
    }
    
    if (text =="modere") {
        return 2; 
    }
      
    if (text =="grave") {
        return 3; 
    }
    

  }




    var options = {
        fill: {
  colors: ['#d75146','#F44336','#F44336',]
},
          series: [{
          name: 'Damage',
          data: [damagelevel("{{data.H_G_0005}}"), damagelevel("{{data.H_G_0006}}"), damagelevel("{{data.H_G_0007}}"), damagelevel("{{data.H_G_0008}}"), damagelevel("{{data.H_G_0009}}")]
        }],
          chart: {
          height: 500,
          type: 'bar',
        },
        plotOptions: {
            
          bar: {
            columnWidth: '30%',
            barHeight: '40%',
            borderRadius: 10,
            dataLabels: {
                enabled: false, // top, center, bottom
            },
          
          }
        },
        
        dataLabels: {
          enabled: false,
          formatter: function (val) {
            return val;
          },
         
          style: {
            fontSize: '12px',
            colors: ["#F44336"]
          }
        },
        
        xaxis: {

            labels: {
          show: true,
          rotate: -45,
          rotateAlways: false,
          trim: false,
          minHeight: 0,
          maxHeight: 100,
          style: {
              colors: [],
              fontSize: '12px',
              fontFamily: 'Helvetica, Arial, sans-serif',
              fontWeight: 400,
              cssClass: 'apexcharts-xaxis-label',
          },
      },  
          categories: ["Bâtiment effondré", "Mur intérieur et extérieur fissuré", "Mur intérieur et extérieur effondré", "Colonnes, pilastres et corbeaux fissurés et émiettes", "Dalles, poutres, solives fissurées et écaillées"],
          position: 'bottom',
          axisBorder: {
            show: false
          },

          
          axisTicks: {
            show: false
          },
          crosshairs: {
            fill: {
              type: 'gradient',
              gradient: {
                colorFrom: '#F44336',
                colorTo: '#BED1E6',
                stops: [0, 100],
                opacityFrom: 0.4,
                opacityTo: 0.5,
              }
            }
          },
          tooltip: {
            enabled: false,
          }
        },
        yaxis: {
            showForNullSeries: true,
            tickAmount: 2,
          axisBorder: {
            show: true
          },
          axisTicks: {
            show: true,
            borderType: 'solid',
            color: '#78909C',
            width: 4,
            offsetX: 0,
            offsetY: 0,
      },
      
          labels: {
            show: true,
            formatter: function (val) {
                if(val == 0){
                return "aucun";
              }  
              
                if(val == 1){
                return "mineur";
              }  

              

              if(val == 2){
                return "modere";
              }  
              

              if(val == 3){
                return "grave";
              }  
              
             
              

              
            }
          }
        
        },
        title: {
          text: 'Dommages',
          floating: true,
          offsetY: -5,
          align: 'center',
          style: {
            color: '#444'
          }

          
        }

        
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

    });



</script>

        <!-- bundle -->
        <script src="{{ url_for('static', filename='js/vendor.min.js') }}"></script>
        <script src="{{ url_for('static', filename='/js/app.min.js') }}"></script>

        <!-- third party js -->
        <script src="{{ url_for('static', filename='/js/vendor/Chart.bundle.min.js') }}"></script>
        <!-- third party js ends -->

        <!-- demo app -->
        <script src="{{ url_for('static', filename='/js/pages/demo.project-detail.js') }}"></script>
        <!-- end demo js-->
        <script src="{{ url_for('static', filename='/js/vendor/d3.min.js') }}"></script>

        <!-- third party:js -->
        <!-- third party end -->

        <!-- demo:js -->
      


    </body>
</html>
{% endblock %}